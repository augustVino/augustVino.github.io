(window.webpackJsonp=window.webpackJsonp||[]).push([[122],{678:function(t,n,a){"use strict";a.r(n);var e=a(59),s=Object(e.a)({},(function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"微信公众号-h5-支付并签约"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#微信公众号-h5-支付并签约"}},[t._v("#")]),t._v(" 微信公众号 H5 支付并签约")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("本文档只是本人公司项目实践总结，不同公司开发逻辑可能有些许不同，但流程基本相同。")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/pap.php?chapter=18_13&index=5",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信公众号支付并签约官方文档"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://qydev.weixin.qq.com/wiki/index.php?title=OAuth%E9%AA%8C%E8%AF%81%E6%8E%A5%E5%8F%A3",target:"_blank",rel:"noopener noreferrer"}},[t._v("H5 获取授权 code"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/0201zcr/p/5131602.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信公众平台开发——微信授权登录（OAuth2.0）"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"需求描述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#需求描述"}},[t._v("#")]),t._v(" 需求描述")]),t._v(" "),a("p",[a("strong",[t._v("微信内部浏览器")]),t._v("打开商品详情页面（页面已经配置到公众号），执行购买流程")]),t._v(" "),a("p",[a("strong",[t._v("----\x3e")]),t._v(" 点击"),a("strong",[t._v("购买按钮")]),t._v("进入订单结算页面（"),a("strong",[t._v("此步骤需要考虑微信授权问题")]),t._v("）")]),t._v(" "),a("p",[a("strong",[t._v("----\x3e")]),t._v(" 点击"),a("strong",[t._v("确认支付")]),t._v("按钮唤起微信签约并完成支付")]),t._v(" "),a("p",[a("strong",[t._v("----\x3e")]),t._v(" 支付完成后跳转回原页面，并展示相应的支付结果（成功 or 失败）。")]),t._v(" "),a("h2",{attrs:{id:"技术分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#技术分析"}},[t._v("#")]),t._v(" 技术分析")]),t._v(" "),a("table",[a("tr",[a("td",[a("center",[a("img",{attrs:{src:"/img/pay6.1-1.webp"}}),t._v("图1 商品详情页面")])],1),t._v(" "),a("td",[a("center",[a("img",{attrs:{src:"/img/pay6.1-2.webp"}}),t._v("图2 订单结算页面")])],1),t._v(" "),a("td",[a("center",[a("img",{attrs:{src:"/img/pay6.2-1.webp"}}),t._v("图3 微信公众号支付")])],1),t._v(" "),a("td",[a("center",[a("img",{attrs:{src:"/img/pay6.2-2.webp"}}),t._v("图4 微信公众号支付")])],1),t._v(" "),a("td",[a("center",[a("img",{attrs:{src:"/img/pay6.2-3.webp"}}),t._v("图5 微信公众号支付")])],1)])]),t._v(" "),a("ol",[a("li",[t._v("在"),a("strong",[t._v("商品详情")]),t._v("页面，点击 "),a("strong",[a("code",[t._v("￥19")])]),t._v(" 购买按钮，通过"),a("code",[t._v("location.href")]),t._v("跳转到"),a("strong",[t._v("订单结算")]),t._v("页（并把商品信息传递过去）。"),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("由于是微信公众号支付，订单结算页调微信支付并签约时需要传递 code（用户登录凭证）。故此处从商品详情跳转到订单结算时，采用如下跳转逻辑：")])])])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 原理：先跳转到微信授权，然后微信会重定向回redirect_uri页面，")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 同时在页面url后边新增了一个code参数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("terminal "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wechat"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" redirect_uri "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" base"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addBaseParams")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://wx.m.dangdang.com/touch/payVue/auto_pay.html?channelMonthlyStrategyId="')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n            data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"&vipOriginalPrice="')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n            data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("originalPrice "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"&shouldPayMoney="')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstMonthPrice\n                "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstMonthPrice "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("newPrice "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"&cId="')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("vip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("userInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("channelId "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"&strategyGrantStatus="')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n            data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("strategyGrantStatus\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    location"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://open.weixin.qq.com/connect/oauth2/authorize?appid=此处是公司的appid&redirect_uri="')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeURIComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("redirect_uri"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"&response_type=code&scope=snsapi_base&state=123#wechat_redirect"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")]),a("div",{pre:!0,attrs:{class:"m-mdic-copy-wrapper"}},[a("div",{pre:!0,attrs:{class:"u-mdic-copy-notify",id:"j-notify-1589775700997-18096"}},[t._v("copy success")]),a("button",{pre:!0,attrs:{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'// 原理：先跳转到微信授权，然后微信会重定向回redirect_uri页面，\n// 同时在页面url后边新增了一个code参数\nif (this.terminal === "wechat") {\n    let redirect_uri = base.addBaseParams(\n        "http://wx.m.dangdang.com/touch/payVue/auto_pay.html?channelMonthlyStrategyId=" +\n            data.id +\n            "&vipOriginalPrice=" +\n            data.originalPrice / 100 +\n            "&shouldPayMoney=" +\n            (data.firstMonthPrice\n                ? data.firstMonthPrice / 100\n                : data.newPrice / 100) +\n            "&cId=" +\n            this.vip.userInfo.channelId +\n            "&strategyGrantStatus=" +\n            data.strategyGrantStatus\n    );\n\n    location.href =\n        "https://open.weixin.qq.com/connect/oauth2/authorize?appid=此处是公司的appid&redirect_uri=" +\n        encodeURIComponent(redirect_uri) +\n        "&response_type=code&scope=snsapi_base&state=123#wechat_redirect";\n}\n',"data-mdic-attach-content":"","data-mdic-notify-id":"j-notify-1589775700997-18096","data-mdic-notify-delay":"2000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"}},[t._v("copy")])]),a("div",{pre:!0,attrs:{class:"m-mdic-copy-wrapper"}},[a("div",{pre:!0,attrs:{class:"u-mdic-copy-notify",id:"j-notify-1589775700997-18803"}},[t._v("Copy successed")]),a("button",{pre:!0,attrs:{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'// 原理：先跳转到微信授权，然后微信会重定向回redirect_uri页面，\n// 同时在页面url后边新增了一个code参数\nif (this.terminal === "wechat") {\n    let redirect_uri = base.addBaseParams(\n        "http://wx.m.dangdang.com/touch/payVue/auto_pay.html?channelMonthlyStrategyId=" +\n            data.id +\n            "&vipOriginalPrice=" +\n            data.originalPrice / 100 +\n            "&shouldPayMoney=" +\n            (data.firstMonthPrice\n                ? data.firstMonthPrice / 100\n                : data.newPrice / 100) +\n            "&cId=" +\n            this.vip.userInfo.channelId +\n            "&strategyGrantStatus=" +\n            data.strategyGrantStatus\n    );\n\n    location.href =\n        "https://open.weixin.qq.com/connect/oauth2/authorize?appid=此处是公司的appid&redirect_uri=" +\n        encodeURIComponent(redirect_uri) +\n        "&response_type=code&scope=snsapi_base&state=123#wechat_redirect";\n}\n',"data-mdic-attach-content":"","data-mdic-notify-id":"j-notify-1589775700997-18803","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"Copy failed",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"}},[t._v("Copy")])])])]),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[a("strong",[t._v("订单结算")]),t._v("页面初始化时：")]),t._v(" "),a("ul",[a("li",[t._v("获取接收传递过来的商品信息("),a("code",[t._v("info")]),t._v(")、登录凭证("),a("code",[t._v("code")]),t._v(")；")]),t._v(" "),a("li",[t._v("用"),a("code",[t._v("info")]),t._v("调接口，创建订单、并获取订单号("),a("code",[t._v("orderId")]),t._v(")；")])])]),t._v(" "),a("li",[a("p",[t._v("点击"),a("strong",[t._v("订单结算")]),t._v("页面的"),a("strong",[t._v("确认支付")]),t._v("按钮：")]),t._v(" "),a("ul",[a("li",[t._v("通过"),a("code",[t._v("orderId")]),t._v("、登录凭证("),a("code",[t._v("code")]),t._v(")和支付方式("),a("code",[t._v("wxWapPay")]),t._v(")调接口，获取公众号支付相关参数("),a("code",[t._v("wxWapPayParams")]),t._v(")，包含："),a("code",[t._v("appId")]),t._v("（公众号 id）,"),a("code",[t._v("timeStamp")]),t._v("（时间戳）,"),a("code",[t._v("nonceStr")]),t._v("（随机字符串）,"),a("code",[t._v("package")]),t._v("（订单详情扩展字符串）,"),a("code",[t._v("signType")]),t._v("（签名方式）,"),a("code",[t._v("paySign")]),t._v("（签名）。接口返回数据如下："),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"data"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"timeStamp"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1566976572"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"package"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prepay_id=wx28151612470d91a4aa118235623d437700"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"paySign"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2D6809878885EED7F0393C03FDE4AE1F"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"appId"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wx8e4abaf9ec78a134"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"systemDate"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1566976572571"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"signType"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MD5"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"currentDate"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2019-08-28 15:16:12"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"nonceStr"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pOdCxhQpWZupULxMsNAMvrXE"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"systemDate"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1566976572571")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"status"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"code"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")]),a("div",{pre:!0,attrs:{class:"m-mdic-copy-wrapper"}},[a("div",{pre:!0,attrs:{class:"u-mdic-copy-notify",id:"j-notify-1589775700998-52070"}},[t._v("copy success")]),a("button",{pre:!0,attrs:{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'{\n    "data": {\n        "timeStamp": "1566976572",\n        "package": "prepay_id=wx28151612470d91a4aa118235623d437700",\n        "paySign": "2D6809878885EED7F0393C03FDE4AE1F",\n        "appId": "wx8e4abaf9ec78a134",\n        "systemDate": "1566976572571",\n        "signType": "MD5",\n        "currentDate": "2019-08-28 15:16:12",\n        "nonceStr": "pOdCxhQpWZupULxMsNAMvrXE"\n    },\n    "systemDate": 1566976572571,\n    "status": {\n        "code": 0\n    }\n}\n',"data-mdic-attach-content":"","data-mdic-notify-id":"j-notify-1589775700998-52070","data-mdic-notify-delay":"2000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"}},[t._v("copy")])]),a("div",{pre:!0,attrs:{class:"m-mdic-copy-wrapper"}},[a("div",{pre:!0,attrs:{class:"u-mdic-copy-notify",id:"j-notify-1589775700998-63167"}},[t._v("Copy successed")]),a("button",{pre:!0,attrs:{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'{\n    "data": {\n        "timeStamp": "1566976572",\n        "package": "prepay_id=wx28151612470d91a4aa118235623d437700",\n        "paySign": "2D6809878885EED7F0393C03FDE4AE1F",\n        "appId": "wx8e4abaf9ec78a134",\n        "systemDate": "1566976572571",\n        "signType": "MD5",\n        "currentDate": "2019-08-28 15:16:12",\n        "nonceStr": "pOdCxhQpWZupULxMsNAMvrXE"\n    },\n    "systemDate": 1566976572571,\n    "status": {\n        "code": 0\n    }\n}\n',"data-mdic-attach-content":"","data-mdic-notify-id":"j-notify-1589775700998-63167","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"Copy failed",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"}},[t._v("Copy")])])])])]),t._v(" "),a("li",[t._v("判断微信 jsBridge 是否加载完成（页面需要引入微信 js 工具包），加载完成后调起支付")])]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("text/javascript")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("//res.wx.qq.com/open/js/jweixin-1.0.0.js")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")]),a("div",{pre:!0,attrs:{class:"m-mdic-copy-wrapper"}},[a("div",{pre:!0,attrs:{class:"u-mdic-copy-notify",id:"j-notify-1589775700998-16762"}},[t._v("copy success")]),a("button",{pre:!0,attrs:{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"<script type=text/javascript src=//res.wx.qq.com/open/js/jweixin-1.0.0.js><\/script>\n","data-mdic-attach-content":"","data-mdic-notify-id":"j-notify-1589775700998-16762","data-mdic-notify-delay":"2000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"}},[t._v("copy")])]),a("div",{pre:!0,attrs:{class:"m-mdic-copy-wrapper"}},[a("div",{pre:!0,attrs:{class:"u-mdic-copy-notify",id:"j-notify-1589775700998-1056"}},[t._v("Copy successed")]),a("button",{pre:!0,attrs:{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"<script type=text/javascript src=//res.wx.qq.com/open/js/jweixin-1.0.0.js><\/script>\n","data-mdic-attach-content":"","data-mdic-notify-id":"j-notify-1589775700998-1056","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"Copy failed",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"}},[t._v("Copy")])])])]),a("div",{staticClass:"language-vue extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vue"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- vue --\x3e")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 公众号支付所需参数")]),t._v("\n        wxWapPayParams"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nmethods"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 微信公众号支付用到的方法")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("weixinJSBridgeCheck")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 判断微信的WeixinJSBridge")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" WeixinJSBridge "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"undefined"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("addEventListener"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WeixinJSBridgeReady"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onBridgeReady"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("attachEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("attachEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'WeixinJSBridgeReady'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onBridgeReady"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("attachEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'onWeixinJSBridgeReady'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onBridgeReady"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onBridgeReady")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 支付sdk准备完成")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onBridgeReady")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" _this "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 触发微信支付")]),t._v("\n        WeixinJSBridge"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("invoke")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'getBrandWCPayRequest'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("_this"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wxWapPayParams"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("err_msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"get_brand_wcpay_request:ok"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 微信返回支付成功，轮询订单接口确定支付结果")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("省略\n\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  取消支付或者其他情况")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  get_brand_wcpay_request:cancel")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  get_brand_wcpay_request:fail")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// window.location.href = "http://e.dangdang.com/media/h5/ddreader50/vipPayResult-page.html?resultCode=0";')]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")]),a("div",{pre:!0,attrs:{class:"m-mdic-copy-wrapper"}},[a("div",{pre:!0,attrs:{class:"u-mdic-copy-notify",id:"j-notify-1589775700998-82464"}},[t._v("copy success")]),a("button",{pre:!0,attrs:{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'\x3c!-- vue --\x3e\n\n<script>\ndata(){\n    return{\n        // 公众号支付所需参数\n        wxWapPayParams:null\n    }\n},\nmethods:{\n    // 微信公众号支付用到的方法\n    weixinJSBridgeCheck() {\n        // 判断微信的WeixinJSBridge\n        if (typeof WeixinJSBridge == "undefined") {\n            if (document.addEventListener) {\n                document.addEventListener("WeixinJSBridgeReady",this.onBridgeReady,false);\n            }else if (document.attachEvent){\n                document.attachEvent(\'WeixinJSBridgeReady\', this.onBridgeReady);\n                document.attachEvent(\'onWeixinJSBridgeReady\', this.onBridgeReady);\n            }\n        } else {\n            this.onBridgeReady();\n        }\n    },\n    // 支付sdk准备完成\n    onBridgeReady(){\n        const _this = this;\n        // 触发微信支付\n        WeixinJSBridge.invoke(\n            \'getBrandWCPayRequest\',\n            {..._this.wxWapPayParams},\n            function(res){\n                if(res.err_msg == "get_brand_wcpay_request:ok" ) {\n\n                    // 微信返回支付成功，轮询订单接口确定支付结果\n                    ...省略\n\n                } else {\n                    alert(JSON.stringify(res))\n                    //  取消支付或者其他情况\n                    //  get_brand_wcpay_request:cancel\n                    //  get_brand_wcpay_request:fail\n                    // window.location.href = "http://e.dangdang.com/media/h5/ddreader50/vipPayResult-page.html?resultCode=0";\n                }\n            }\n        );\n    }\n}\n<\/script>\n',"data-mdic-attach-content":"","data-mdic-notify-id":"j-notify-1589775700998-82464","data-mdic-notify-delay":"2000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"}},[t._v("copy")])]),a("div",{pre:!0,attrs:{class:"m-mdic-copy-wrapper"}},[a("div",{pre:!0,attrs:{class:"u-mdic-copy-notify",id:"j-notify-1589775700998-44259"}},[t._v("Copy successed")]),a("button",{pre:!0,attrs:{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'\x3c!-- vue --\x3e\n\n<script>\ndata(){\n    return{\n        // 公众号支付所需参数\n        wxWapPayParams:null\n    }\n},\nmethods:{\n    // 微信公众号支付用到的方法\n    weixinJSBridgeCheck() {\n        // 判断微信的WeixinJSBridge\n        if (typeof WeixinJSBridge == "undefined") {\n            if (document.addEventListener) {\n                document.addEventListener("WeixinJSBridgeReady",this.onBridgeReady,false);\n            }else if (document.attachEvent){\n                document.attachEvent(\'WeixinJSBridgeReady\', this.onBridgeReady);\n                document.attachEvent(\'onWeixinJSBridgeReady\', this.onBridgeReady);\n            }\n        } else {\n            this.onBridgeReady();\n        }\n    },\n    // 支付sdk准备完成\n    onBridgeReady(){\n        const _this = this;\n        // 触发微信支付\n        WeixinJSBridge.invoke(\n            \'getBrandWCPayRequest\',\n            {..._this.wxWapPayParams},\n            function(res){\n                if(res.err_msg == "get_brand_wcpay_request:ok" ) {\n\n                    // 微信返回支付成功，轮询订单接口确定支付结果\n                    ...省略\n\n                } else {\n                    alert(JSON.stringify(res))\n                    //  取消支付或者其他情况\n                    //  get_brand_wcpay_request:cancel\n                    //  get_brand_wcpay_request:fail\n                    // window.location.href = "http://e.dangdang.com/media/h5/ddreader50/vipPayResult-page.html?resultCode=0";\n                }\n            }\n        );\n    }\n}\n<\/script>\n',"data-mdic-attach-content":"","data-mdic-notify-id":"j-notify-1589775700998-44259","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"Copy failed",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"}},[t._v("Copy")])])])])])]),t._v(" "),a("p",[t._v("同样，在支付后，需要轮询订单支付结果接口获取支付状态。")]),t._v(" "),a("star-star"),t._v(" "),a("comment-comment"),t._v(" "),a("back-to-top")],1)}),[],!1,null,null,null);n.default=s.exports}}]);